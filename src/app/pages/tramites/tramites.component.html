<div class="page-header d-print-none">
  <div class="container-xl">
    <div class="row align-items-center">
      <div class="col">
        <div class="page-pretitle"></div>
        <h2 class="page-title">Categorias</h2>
      </div>
      <div class="col-auto ms-auto">
        <div class="btn-list">
          <button class="btn-tramite" (click)="muestraAviso(content, 1, '')">
            <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M12 19h-7a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v3.5" />
              <path d="M16 19h6" />
              <path d="M19 16v6" />
            </svg>
            <span>Agregar categoria</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="page-body">
  <div class="container-xl">
    <div class="card">
      <div class="table-responsive">
        <table class="table table-vcenter text-nowrap datatable" style="width: 100%">
          <thead>
            <tr>
              <th>
                <button class="table-sort" (click)="sort('')">
                  Descripción
                </button>
              </th>
              <th>
                <button class="table-sort" (click)="sort('')">
                  Fecha Creación
                </button>
              </th>
              <th>
                <button class="table-sort" (click)="sort('')">
                  Fecha Actualización
                </button>
              </th>
              <th>
                <button class="table-sort" (click)="sort('')">
                  Publicación
                </button>
              </th>
              <th></th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            @for (tramite of data.data; track $index) {
            <tr>
              <td>{{ tramite.descripcion }}</td>
              <td>{{ tramite.created_at | date : "dd-MM-yyyy H:mm:ss" }}</td>
              <td>{{ tramite.updated_at | date : "dd-MM-yyyy H:mm:ss" }}</td>
              <td>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault"
                    [checked]="tramite.estatus" (change)="actualizaTramiteEstatus($event, tramite)" />
                </div>
              </td>
              <td class="text-center">
                <button class="btn-tramite" (click)="muestraAviso(content, 2, tramite)">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round"
                    class="icon icon-tabler icons-tabler-outline icon-tabler-edit">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1" />
                    <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z" />
                    <path d="M16 5l3 3" />
                  </svg>
                </button>
              </td>
              <td class="text-center">
                <button class="btn-tramite" (click)="borraTramiteID(tramite)">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round"
                    class="icon icon-tabler icons-tabler-outline icon-tabler-trash">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M4 7l16 0" />
                    <path d="M10 11l0 6" />
                    <path d="M14 11l0 6" />
                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                  </svg>
                </button>
              </td>
            </tr>
             }
          </tbody>
        </table>
      </div>

      <div class="card-body">
        <p class="m-0 text-secondary">
          Mostrando <span> {{ paginationQuery.page }}</span> -
          <span> {{ data.last_page }} </span> de
          <span> {{ data.total }} </span> entradas
        </p>
      </div>
      <div class="card-footer">
        <ngb-pagination class="m-0 ms-auto" [(page)]="paginationQuery.page" (pageChange)="getData()"
          [pageSize]="paginationQuery.limit || 10" [boundaryLinks]="true" [collectionSize]="data.total"
          [ellipses]="false" [rotate]="true" [maxSize]="5" />
      </div>

    </div>
  </div>
</div>
<ng-template #content let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Agregar categoria</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body" style="text-align: justify">
    <div class="row">
      <div class="col-lg-12 col-12 mb-3">
        <label class="form-label">Categorias</label>
        <input type="text" class="form-control" name="example-text-input" placeholder="Ingrese el nombre del trámite"
          [(ngModel)]="payload.descripcion" #descripcionInput />
      </div>
      <div class="col-lg-12 col-12 mb-3">
        <label class="form-label">Detalle</label>
        <textarea type="text" rows="5" class="form-control" name="example-text-input" placeholder="Detalle el trámite"
          maxlength="300" [(ngModel)]="payload.detalle" #detalleInput></textarea>
      </div>
      <div class="col-lg-12 col-12 mb-3">
        <label class="form-label">No mostrar a usuario</label>
        <h6>Los usuarios que se seleccionen no podrán ver el registro</h6>
        <select class="form-select" multiple name="usuario" [(ngModel)]="payload.tipo_usuarios_restringidos"
          [class.is-invalid]="
            usuario.invalid && (usuario.dirty || usuario.touched)
          " required #usuario="ngModel" style="width: 80%">
          <option *ngFor="let usu of catTipoU" [value]="usu.id">
            {{ usu.descripcion }}
          </option>
        </select>
        <label>
          <h6>Presione la tecla ctrl y seleccione las opciones</h6>
        </label>
      </div>
      <div class="col-lg-12 col-12 mb-3 form-check form-switch">
        <label class="form-label">¿Es un servicio?</label>
        <input class="form-check-input" type="checkbox" id="isService" [(ngModel)]="payload.is_service"
          (change)="is_service($event)" />
        <h6>{{payload.is_service ? 'Este registro es un servicio' : 'Este registro no es un servicio'}}</h6>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">
      Cerrar
    </button>
    <button type="button" *ngIf="addEdit == 1" class="btn btn-aceptar" (click)="guardarTramite()">
      Guardar
    </button>
    <button type="button" *ngIf="addEdit == 2" class="btn btn-aceptar" (click)="actualizaTramiteID()">
      Editar
    </button>
  </div>
</ng-template>